<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>In My Head</title>
    <link href="https://fonts.googleapis.com/css2?family=Fredoka+One&family=Nunito:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        /* --- 1. THEME & UI --- */
        body {
            margin: 0; overflow: hidden; background-color: #050510;
            font-family: 'Nunito', sans-serif; user-select: none;
        }
        #bg-gradient {
            position: absolute; width: 100%; height: 100%;
            background: radial-gradient(circle at center 60%, #2a1b5a 0%, #120a28 50%, #050210 100%);
            z-index: -2;
        }

        /* LOGO */
        .logo-container {
            position: absolute; top: 3%; left: 50%; transform: translateX(-50%);
            text-align: center; pointer-events: none; z-index: 10;
            filter: drop-shadow(0 0 20px rgba(0,0,0,0.6));
            width: 100%;
        }
        .logo-main {
            font-family: 'Fredoka One', cursive; font-size: 5rem; color: #fff;
            -webkit-text-stroke: 4px #004e92; text-shadow: 4px 4px 0 #004e92; line-height: 1; display: inline-block;
        }
        .logo-sub {
            font-family: 'Fredoka One', cursive; font-size: 5rem; color: #ffd700;
            -webkit-text-stroke: 3px #d35400; text-shadow: 3px 3px 0 #d35400; display: inline-block; margin-left: 15px;
        }

        /* --- INFO PANEL CSS --- */
        #info-panel {
            position: absolute; top: 50%; left: 50%;
            transform: translate(-50%, -50%) scale(0.9);
            width: 500px;
            max-height: 80vh;
            background: rgba(30, 25, 55, 0.98);
            border: 3px solid rgba(255, 255, 255, 0.2);
            border-radius: 30px; padding: 10px;
            text-align: center; color: white; opacity: 0; pointer-events: none;
            transition: 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.27);
            box-shadow: 0 30px 60px rgba(0,0,0,0.8);
            display: flex; flex-direction: column;
        }
        #info-panel.active { transform: translate(-50%, -50%) scale(1); opacity: 1; pointer-events: auto; }

        /* Inner scrolling container */
        .panel-scroll-container {
            overflow-y: auto; padding: 30px;
            scrollbar-width: thin; scrollbar-color: rgba(255,255,255,0.3) transparent;
        }
        .panel-scroll-container::-webkit-scrollbar { width: 8px; }
        .panel-scroll-container::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.3); border-radius: 4px; }
        
        .memory-icon { font-size: 60px; display: block; margin: 0 auto 5px auto; filter: drop-shadow(0 0 20px currentColor); }
        
        /* 1. EMOTION NAME (Big Title at Top) */
        h1 { 
            font-family: 'Fredoka One', cursive; 
            font-size: 3.5rem; 
            margin: 0; 
            line-height: 1; 
            text-transform: uppercase;
            letter-spacing: 2px;
            text-shadow: 0 4px 10px rgba(0,0,0,0.5);
        }

        /* 2. MEMORY CONTEXT (Subtitle) */
        h2 { 
            font-family: 'Nunito', sans-serif;
            font-size: 1.4rem; 
            margin: 5px 0 20px 0; 
            font-weight: 800;
            text-transform: uppercase; 
            letter-spacing: 1px; 
            color: rgba(255,255,255,0.7);
        }

        p { font-size: 1.1rem; line-height: 1.6; font-weight: 600; opacity: 0.9; color: #e0e0ff; margin-bottom: 25px; white-space: pre-wrap; }
        
        /* Image Grid */
        #panel-images {
            display: flex; flex-wrap: wrap; justify-content: center; gap: 12px; margin-top: 20px;
        }
        .memory-img {
            width: 130px; height: 130px; object-fit: cover;
            border-radius: 15px; border: 2px solid rgba(255,255,255,0.3);
            box-shadow: 0 10px 20px rgba(0,0,0,0.3); transition: transform 0.2s;
        }
        .memory-img:hover { transform: scale(1.05); z-index: 5; }

        .close-btn {
            position: absolute; top: 15px; right: 20px; font-size: 30px; z-index: 10;
            cursor: pointer; color: rgba(255,255,255,0.5); font-family: sans-serif; transition: 0.2s;
        }
        .close-btn:hover { color: white; transform: scale(1.1); }
        .instruction { position: absolute; bottom: 30px; width: 100%; text-align: center; color: rgba(255, 255, 255, 0.5); font-size: 14px; letter-spacing: 3px; font-weight: 800; text-transform: uppercase; pointer-events: none; }
    </style>
</head>
<body>

    <div id="bg-gradient"></div>
    <div class="logo-container">
        <div class="logo-main">In My <span class="logo-sub">Head</span></div>
    </div>
    <div id="canvas-container" style="width:100vw; height:100vh;"></div>
    <div class="instruction">Hover to Pause â€¢ Click Orbs to Remember</div>

    <div id="info-panel">
        <div class="close-btn">Ã—</div>
        <div class="panel-scroll-container">
            <div class="memory-icon" id="panel-emoji"></div>
            
            <h1 id="panel-emotion-name">JOY</h1>
            
            <h2 id="panel-memory-title">Specific Memory</h2>
            
            <p id="panel-desc">Description text...</p>
            <div id="panel-images"></div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>

    <script>
        // --- 2. MARBLE TEXTURE ---
        function createCloudyMarbleTexture(colorHex) {
            const size = 512; const canvas = document.createElement('canvas'); canvas.width = size; canvas.height = size; const ctx = canvas.getContext('2d'); const color = new THREE.Color(colorHex);
            const baseColor = `rgb(${Math.floor(color.r*230)}, ${Math.floor(color.g*230)}, ${Math.floor(color.b*230)})`;
            const swirlColor = `rgb(${Math.floor(color.r*255 + 40)}, ${Math.floor(color.g*255 + 40)}, ${Math.floor(color.b*255 + 40)})`;
            const highlightColor = `rgba(255,255,255, 0.4)`;
            ctx.fillStyle = baseColor; ctx.fillRect(0,0,size,size); ctx.filter = 'blur(30px)'; ctx.globalAlpha = 0.7;
            for(let i=0; i<8; i++) { ctx.beginPath(); ctx.moveTo(Math.random()*size, Math.random()*size); ctx.bezierCurveTo(Math.random()*size, Math.random()*size, Math.random()*size, Math.random()*size, Math.random()*size, Math.random()*size); ctx.strokeStyle = swirlColor; ctx.lineWidth = Math.random()*80 + 40; ctx.lineCap = 'round'; ctx.stroke(); }
            ctx.filter = 'blur(15px)'; ctx.globalAlpha = 0.5;
            for(let i=0; i<20; i++) { ctx.beginPath(); ctx.arc(Math.random()*size, Math.random()*size, Math.random()*30+10, 0, Math.PI*2); ctx.fillStyle = highlightColor; ctx.fill(); }
            return new THREE.CanvasTexture(canvas);
        }

        // --- 3. SCENE SETUP ---
        const container = document.getElementById('canvas-container');
        const scene = new THREE.Scene();
        scene.fog = new THREE.FogExp2(0x2a0a4a, 0.012);
        const camera = new THREE.PerspectiveCamera(50, window.innerWidth / window.innerHeight, 0.1, 1000);
        camera.position.set(0, 6, 18); camera.lookAt(0, 3, 0);
        const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
        renderer.setSize(window.innerWidth, window.innerHeight); renderer.setPixelRatio(window.devicePixelRatio);
        renderer.toneMapping = THREE.ReinhardToneMapping; renderer.toneMappingExposure = 1.3;
        container.appendChild(renderer.domElement);

        // --- 4. LIGHTING ---
        scene.add(new THREE.AmbientLight(0x1a1a2e, 0.2));
        const spotLight = new THREE.SpotLight(0x4488ff, 0.5); spotLight.position.set(0, 25, 0); spotLight.penumbra = 0.7; scene.add(spotLight);
        const rimLight = new THREE.PointLight(0x6644aa, 0.8, 40); rimLight.position.set(0, 8, -15); scene.add(rimLight);

        // --- 5. MATERIALS ---
        const marbleConsoleTexture = createCloudyMarbleTexture(0xe8e8f0);
        const consoleMaterial = new THREE.MeshPhysicalMaterial({ 
            color: 0xffffff, 
            map: marbleConsoleTexture, 
            roughness: 0.05, 
            metalness: 0.9, 
            clearcoat: 1.0,
            clearcoatRoughness: 0.1,
            emissive: 0xaaccff, 
            emissiveIntensity: 0.3 
        });
        const trackMaterial = new THREE.MeshStandardMaterial({ 
            color: 0x6699ff, 
            emissive: 0x4488ff, 
            emissiveIntensity: 1.2, 
            roughness: 0.1, 
            metalness: 0.8,
            transparent: true,
            opacity: 0.9
        });

        // --- 6. BACKGROUND WALL (STRICT PERFECT GRID) ---
        const wallGroup = new THREE.Group();
        const orbCount = 10000; const dummy = new THREE.Object3D();
        const wallGeo = new THREE.SphereGeometry(0.35, 8, 8); const wallMat = new THREE.MeshBasicMaterial({ color: 0xffffff });
        const wallMesh = new THREE.InstancedMesh(wallGeo, wallMat, orbCount);
        const palette = [new THREE.Color(0xFFD700), new THREE.Color(0x4A90E2), new THREE.Color(0xE74C3C), new THREE.Color(0xA359FF), new THREE.Color(0x7FD67F)];
        
        let index = 0; 
        const wallRadius = 100;
        const shelfHeight = 1.2; 

        for (let row = -35; row < 45; row++) {
            const y = row * shelfHeight;
            const orbsInRow = 140;
            for (let i = 0; i < orbsInRow; i++) {
                if (index >= orbCount) break;
                const angleRange = Math.PI * 1.8; 
                const angle = (i / orbsInRow) * angleRange - (angleRange / 2); 
                const x = Math.sin(angle) * wallRadius;
                const z = Math.cos(angle) * wallRadius - wallRadius - 35; 
                dummy.position.set(x, y, z);
                dummy.scale.setScalar(1); 
                dummy.updateMatrix();
                wallMesh.setMatrixAt(index, dummy.matrix);
                wallMesh.setColorAt(index, palette[Math.floor(Math.random() * palette.length)]);
                index++;
            }
        }
        wallMesh.instanceMatrix.needsUpdate = true; wallGroup.add(wallMesh); scene.add(wallGroup);

        // --- 7. CONSOLE ---
        const standGroup = new THREE.Group(); scene.add(standGroup);
        const points = [new THREE.Vector2(2.2, 0), new THREE.Vector2(1.2, 2.0), new THREE.Vector2(1.2, 3.5), new THREE.Vector2(4.5, 5.0), new THREE.Vector2(4.5, 5.5)];
        const stand = new THREE.Mesh(new THREE.LatheGeometry(points, 64), consoleMaterial); stand.position.y = -3.5; standGroup.add(stand);
        const underglowLight = new THREE.PointLight(0x4488ff, 8, 20); underglowLight.position.set(0, -3, 0); scene.add(underglowLight);
        const glowDiscGeo = new THREE.CircleGeometry(2.5, 32); const glowDiscMat = new THREE.MeshBasicMaterial({ color: 0x4488ff, transparent: true, opacity: 0.6, side: THREE.DoubleSide });
        const glowDisc = new THREE.Mesh(glowDiscGeo, glowDiscMat); glowDisc.rotation.x = -Math.PI / 2; glowDisc.position.y = -3.3; scene.add(glowDisc);
        const trackGeo = new THREE.RingGeometry(2.5, 4.4, 64); const track = new THREE.Mesh(trackGeo, trackMaterial); track.rotation.x = -Math.PI / 2; track.position.y = 1.75; scene.add(track);
        const lid = new THREE.Mesh(new THREE.CylinderGeometry(4.5, 4.5, 0.3, 64), consoleMaterial); lid.position.y = 4.35; scene.add(lid);
        const pillar = new THREE.Mesh(new THREE.CylinderGeometry(1.2, 1.2, 3.5, 32), new THREE.MeshPhysicalMaterial({color: 0xffffff, transmission: 0.5, opacity: 0.8, transparent:true})); pillar.position.y = 2.0; scene.add(pillar);

        // --- 8. MEMORY ORBS ---
        const carousel = new THREE.Group(); carousel.position.y = 2.95; scene.add(carousel);
        const clickables = [];

        // *** UPDATED MEMORIES ***
        const memories = [
            { 
                id: 'JOY', 
                color: 0xFFD700, 
                emoji: 'ðŸ¥°', 
                memoryTitle: 'The Dallas Trip', 
                text: "When my out of state roomies did a Dallas trip and we hung out at all our friends' houses like a week long sleepover! It was so fun getting to show them around, try new food, and just hang out together.",
                images: [
                    'https://placehold.co/200x200/FFD700/ffffff?text=The+Mall',
                    'https://placehold.co/200x200/FFD700/ffffff?text=Food+Pics',
                    'https://placehold.co/200x200/FFD700/ffffff?text=Squad'
                ]
            },
            { 
                id: 'SADNESS', 
                color: 0x4A90E2, // Blue
                emoji: 'ðŸ“', 
                memoryTitle: 'Finding Home', 
                text: "From 6th to 10th grade, I moved to a new school every single year. It was so hard to maintain friendships or even define where 'home' was. Eventually, I realized that home isn't a place on a Texas mapâ€”it's wherever my family is. As long as I'm with them, I'm home.",
                images: [
                      'https://placehold.co/200x200/4A90E2/ffffff?text=Texas+Map+Pins',
                      'https://placehold.co/200x200/4A90E2/ffffff?text=Family'
                ] 
            },
            { 
                id: 'ANXIETY', // Changed from Anger
                color: 0xFF7F50, // Coral/Orange for Anxiety
                emoji: 'ðŸ†', 
                memoryTitle: 'The Solo Debater', 
                text: "I joined debate in a high school that had zero funding and no coach. It was terrifying going up against huge teams, but I taught myself everything through online resources. All that stress paid offâ€”I finished ranked 6th in Texas, the most competitive state in the nation.", 
                images: [
                    'https://placehold.co/200x200/FF7F50/ffffff?text=State+Trophy',
                    'https://placehold.co/200x200/FF7F50/ffffff?text=Rank+6th'
                ] 
            },
            { 
                id: 'DISGUST', 
                color: 0x7FD67F, // Green
                emoji: 'ðŸ¤¢', 
                memoryTitle: 'The Red Dress Omen', 
                text: "Oct 19, 2024. UT vs Georgia. I ordered a cute dress online thinking it was 'burnt orange.' It arrived BRIGHT RED. My friends trolled me, but I wore it anyway. We ended up losing BADLY. I literally foreshadowed the loss by wearing the opps' colors. Gross.", 
                images: [
                    'https://placehold.co/200x200/7FD67F/ffffff?text=Red+Dress+Fail',
                    'https://placehold.co/200x200/7FD67F/ffffff?text=Final+Score'
                ] 
            },
            { 
                id: 'FEAR', 
                color: 0xA359FF, // Purple
                emoji: 'ðŸ“„', 
                memoryTitle: 'The Visa Switch', 
                text: "Switching to a student visa this semester for internships feels like jumping off a cliff. It's not just paperwork; it's the weight of independence. Navigating a new legal system alone, instead of just being under my parents' safety net, is genuinely terrifying but necessary.", 
                images: [
                    'https://placehold.co/200x200/A359FF/ffffff?text=Student+Visa',
                    'https://placehold.co/200x200/A359FF/ffffff?text=Independence'
                ] 
            },
            { 
                id: 'EMBARRASSMENT', // Changed from Envy
                color: 0xFF69B4, // Hot Pink
                emoji: 'ðŸ˜³', 
                memoryTitle: 'The Mac & Cheese Incident', 
                text: "One night, I was so tired I put Easy Mac in the microwave... and forgot the water. Smoke everywhere. The smell of burnt noodles. The FIRE ALARM went off. The RA was furious, and I got absolutely roasted in the floor GroupMe. I was mortified... but I haven't burnt pasta since!", 
                images: [
                    'https://placehold.co/200x200/FF69B4/ffffff?text=Burnt+Noodles',
                    'https://placehold.co/200x200/FF69B4/ffffff?text=Fire+Alarm'
                ] 
            }
        ];

        const radius = 3.3; const step = (Math.PI * 2) / memories.length;
        memories.forEach((mem, i) => {
            const angle = i * step;
            const orbGeo = new THREE.SphereGeometry(1.2, 64, 64);
            
            // --- UPDATED ORB MATERIAL (NO TRANSPARENCY) ---
            const orbMat = new THREE.MeshPhysicalMaterial({
                color: mem.color, 
                map: createCloudyMarbleTexture(mem.color),
                metalness: 0.1, 
                roughness: 0.15, 
                clearcoat: 1.0, 
                clearcoatRoughness: 0.05,
                emissive: mem.color, 
                emissiveIntensity: 2.5,
                transparent: false, // CHANGED
                opacity: 1.0        // CHANGED
                // transmission removed
            });
            const orb = new THREE.Mesh(orbGeo, orbMat);
            orb.position.set(Math.cos(angle) * radius, 0, Math.sin(angle) * radius);
            orb.add(new THREE.PointLight(mem.color, 12, 15));
            orb.userData = mem; 
            carousel.add(orb); clickables.push(orb);
        });

        const coreGeo = new THREE.SphereGeometry(1.3, 64, 64);
        
        // --- UPDATED CORE MATERIAL (NO TRANSPARENCY) ---
        const coreMat = new THREE.MeshPhysicalMaterial({ 
            color: 0xFFD700, 
            map: createCloudyMarbleTexture(0xFFD700), 
            roughness: 0.15, 
            emissive: 0xFFD700, 
            emissiveIntensity: 3.0,
            transparent: false, // CHANGED
            opacity: 1.0        // CHANGED
            // transmission removed
        });
        const coreOrb = new THREE.Mesh(coreGeo, coreMat);
        coreOrb.position.set(0, 5.75, 0); coreOrb.add(new THREE.PointLight(0xFFD700, 15, 18));
        coreOrb.userData = { 
            id: 'CORE', 
            emoji: 'ðŸŒŸ', 
            memoryTitle: 'Welcome Home', 
            color: 0xFFD700,
            text: 'Welcome to the Headquarters of my mind! Click around to see some of our defining moments.',
            images: []
        };
        scene.add(coreOrb); clickables.push(coreOrb);

        // --- 10. INTERACTION LOGIC ---
        const raycaster = new THREE.Raycaster(); const mouse = new THREE.Vector2();
        let isHovering = false; let rotationSpeed = 0.015;

        window.addEventListener('mousemove', (e) => {
            mouse.x = (e.clientX / window.innerWidth) * 2 - 1; mouse.y = -(e.clientY / window.innerHeight) * 2 + 1;
            raycaster.setFromCamera(mouse, camera);
            isHovering = raycaster.intersectObjects(clickables).length > 0;
            document.body.style.cursor = isHovering ? 'pointer' : 'default';
        });

        window.addEventListener('click', () => {
            if (isHovering) {
                raycaster.setFromCamera(mouse, camera);
                const intersects = raycaster.intersectObjects(clickables);
                if (intersects.length > 0) showPanel(intersects[0].object.userData);
            } else hidePanel();
        });

        // --- UPDATED SHOW PANEL FUNCTION ---
        const panel = document.getElementById('info-panel');
        const panelImagesContainer = document.getElementById('panel-images');
        const panelScrollContainer = document.querySelector('.panel-scroll-container');

        function showPanel(data) {
            panelScrollContainer.scrollTop = 0;

            // 1. Set Emoji
            document.getElementById('panel-emoji').innerText = data.emoji;
            document.getElementById('panel-emoji').style.color = '#' + data.color.toString(16);
            
            // 2. Set Emotion Name
            const emotionTitle = document.getElementById('panel-emotion-name');
            emotionTitle.innerText = data.id;
            emotionTitle.style.color = '#' + data.color.toString(16);
            emotionTitle.style.textShadow = `0 0 15px #${data.color.toString(16)}`;

            // 3. Set Memory Context Title
            const memoryTitle = document.getElementById('panel-memory-title');
            memoryTitle.innerText = data.memoryTitle;

            // 4. Set Description
            document.getElementById('panel-desc').innerText = data.text;

            // 5. Panel Glow
            panel.style.boxShadow = `0 0 60px #${data.color.toString(16)}`;
            panel.style.borderColor = '#' + data.color.toString(16);

            // 6. Images
            panelImagesContainer.innerHTML = '';
            if (data.images && data.images.length > 0) {
                data.images.forEach(imgUrl => {
                    const img = document.createElement('img');
                    img.src = imgUrl;
                    img.className = 'memory-img';
                    img.style.borderColor = '#' + data.color.toString(16);
                    panelImagesContainer.appendChild(img);
                });
            }
            panel.classList.add('active');
        }

        function hidePanel() { panel.classList.remove('active'); }
        document.querySelector('.close-btn').addEventListener('click', hidePanel);
        window.addEventListener('resize', () => { camera.aspect = window.innerWidth / window.innerHeight; camera.updateProjectionMatrix(); renderer.setSize(window.innerWidth, window.innerHeight); });

        // --- 11. ANIMATION ---
        function animate() {
            requestAnimationFrame(animate);
            const targetSpeed = isHovering ? 0 : 0.015; rotationSpeed += (targetSpeed - rotationSpeed) * 0.1;
            carousel.rotation.y -= rotationSpeed;
            const time = Date.now() * 0.001;
            carousel.position.y = 2.95 + Math.sin(time) * 0.05;
            coreOrb.position.y = 5.75 + Math.sin(time*1.2) * 0.1;
            wallGroup.rotation.y = Math.sin(time * 0.02) * 0.03;
            renderer.render(scene, camera);
        }
        animate();
    </script>
</body>
</html>