<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Inside Out HQ - Final Marble Console</title>
    <link href="https://fonts.googleapis.com/css2?family=Fredoka+One&family=Nunito:wght@700;900&display=swap" rel="stylesheet">
    <style>
        /* --- 1. THEME & UI --- */
        body {
            margin: 0;
            overflow: hidden;
            background-color: #050510;
            font-family: 'Nunito', sans-serif;
            user-select: none;
        }

        /* NEW BACKGROUND: HQ Vibe */
        #bg-gradient {
            position: absolute; width: 100%; height: 100%;
            /* Brighter center, deep purple edges like HQ */
            background: radial-gradient(circle at center 60%, #4a1b7a 0%, #220a38 40%, #050210 100%);
            z-index: -2;
        }

        /* Subtle atmospheric particles */
        .dust {
            position: absolute; width: 100%; height: 100%; top: 0; left: 0;
            background-image: 
                radial-gradient(1px 1px at 100px 100px, rgba(255,255,255,0.4), transparent),
                radial-gradient(2px 2px at 300px 200px, rgba(255,215,0, 0.4), transparent),
                radial-gradient(1.5px 1.5px at 600px 400px, rgba(100,150,255,0.4), transparent);
            background-size: 600px 600px;
            animation: drift 20s infinite linear;
            opacity: 0.5; z-index: -1;
        }
        @keyframes drift { from { background-position: 0 0; } to { background-position: 600px 600px; } }

        /* LOGO */
        .logo-container {
            position: absolute; top: 3%; left: 50%; transform: translateX(-50%);
            text-align: center; pointer-events: none; z-index: 10;
            filter: drop-shadow(0 0 20px rgba(0,0,0,0.6));
        }
        .logo-main {
            font-family: 'Fredoka One', cursive; font-size: 5rem; color: #fff;
            -webkit-text-stroke: 4px #004e92;
            text-shadow: 4px 4px 0 #004e92;
            line-height: 0.85;
        }
        .logo-sub {
            font-family: 'Fredoka One', cursive; font-size: 4rem; color: #ffd700;
            -webkit-text-stroke: 3px #d35400;
            text-shadow: 3px 3px 0 #d35400;
            display: block;
        }

        /* INFO PANEL */
        #info-panel {
            position: absolute; top: 50%; left: 50%;
            transform: translate(-50%, -50%) scale(0.8);
            width: 380px;
            background: rgba(30, 25, 50, 0.95); /* Slightly purpler panel */
            border: 4px solid rgba(255, 255, 255, 0.2);
            border-radius: 40px; padding: 40px;
            text-align: center; color: white;
            opacity: 0; pointer-events: none;
            transition: 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.27);
            box-shadow: 0 30px 60px rgba(0,0,0,0.8);
        }
        #info-panel.active { transform: translate(-50%, -50%) scale(1); opacity: 1; pointer-events: auto; }
        
        .memory-icon { font-size: 80px; display: block; margin-bottom: 15px; filter: drop-shadow(0 0 30px currentColor); }
        h2 { font-family: 'Fredoka One', cursive; font-size: 2.8rem; margin: 5px 0 15px 0; text-transform: uppercase; letter-spacing: 2px; }
        p { font-size: 1.2rem; line-height: 1.5; font-weight: 700; opacity: 0.9; color: #e0e0ff; }
        
        .close-btn {
            position: absolute; top: 20px; right: 25px; font-size: 30px; 
            cursor: pointer; color: rgba(255,255,255,0.5); font-family: sans-serif; transition: 0.2s;
        }
        .close-btn:hover { color: white; transform: scale(1.1); }

        .instruction {
            position: absolute; bottom: 30px; width: 100%; text-align: center;
            color: rgba(255, 255, 255, 0.5); font-size: 14px; letter-spacing: 3px;
            font-weight: 800; text-transform: uppercase; pointer-events: none;
        }
    </style>
</head>
<body>

    <div id="bg-gradient"></div>
    <div class="dust"></div>

    <div class="logo-container">
        <div class="logo-main">INSIDE <span class="logo-sub">ME</span></div>
    </div>

    <div id="canvas-container" style="width:100vw; height:100vh;"></div>
    
    <div class="instruction">Hover to Pause â€¢ Click to Explore</div>

    <div id="info-panel">
        <div class="close-btn">Ã—</div>
        <div class="memory-icon" id="panel-emoji"></div>
        <h2 id="panel-title">JOY</h2>
        <p id="panel-desc">Description here...</p>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>

    <script>
        // --- 1. CONFIGURATION ---
        const IMAGE_JOY = 'https://placehold.co/400x600/FFD700/ffffff?text=JOY+PNG'; 
        const IMAGE_SADNESS = 'https://placehold.co/400x600/4A90E2/ffffff?text=SADNESS+PNG';

        // --- 2. IMPROVED MARBLE TEXTURE GENERATOR ---
        // Creates softer, cloudier swirls for a better marble look
        function createCloudyMarbleTexture(colorHex) {
            const size = 512;
            const canvas = document.createElement('canvas'); canvas.width = size; canvas.height = size;
            const ctx = canvas.getContext('2d');
            const color = new THREE.Color(colorHex);
            
            // Base colors: slightly darker and slightly lighter versions of the main color
            const baseColor = `rgb(${Math.floor(color.r*230)}, ${Math.floor(color.g*230)}, ${Math.floor(color.b*230)})`;
            const swirlColor = `rgb(${Math.floor(color.r*255 + 40)}, ${Math.floor(color.g*255 + 40)}, ${Math.floor(color.b*255 + 40)})`;
            const highlightColor = `rgba(255,255,255, 0.4)`;

            ctx.fillStyle = baseColor; ctx.fillRect(0,0,size,size);

            // Heavy blur for soft clouds
            ctx.filter = 'blur(30px)';
            ctx.globalAlpha = 0.7;

            // Draw large, soft swirls
            for(let i=0; i<8; i++) {
                ctx.beginPath();
                ctx.moveTo(Math.random()*size, Math.random()*size);
                ctx.bezierCurveTo(Math.random()*size, Math.random()*size, Math.random()*size, Math.random()*size, Math.random()*size, Math.random()*size);
                ctx.strokeStyle = swirlColor; ctx.lineWidth = Math.random()*80 + 40; ctx.lineCap = 'round'; ctx.stroke();
            }

            // Add soft highlights
            ctx.filter = 'blur(15px)';
            ctx.globalAlpha = 0.5;
            for(let i=0; i<20; i++) {
                ctx.beginPath();
                ctx.arc(Math.random()*size, Math.random()*size, Math.random()*30+10, 0, Math.PI*2);
                ctx.fillStyle = highlightColor; ctx.fill();
            }

            return new THREE.CanvasTexture(canvas);
        }

        // --- 3. SCENE SETUP ---
        const container = document.getElementById('canvas-container');
        const scene = new THREE.Scene();
        // Lighter purple fog to match new BG
        scene.fog = new THREE.FogExp2(0x2a0a4a, 0.015);

        const camera = new THREE.PerspectiveCamera(50, window.innerWidth / window.innerHeight, 0.1, 1000);
        camera.position.set(0, 6, 18); 
        camera.lookAt(0, 3, 0);

        const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: false });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.setPixelRatio(window.devicePixelRatio);
        renderer.toneMapping = THREE.ReinhardToneMapping;
        renderer.toneMappingExposure = 1.3; // Slightly brighter
        container.appendChild(renderer.domElement);

        // --- 4. LIGHTING ---
        scene.add(new THREE.AmbientLight(0xffffff, 0.5));
        const spotLight = new THREE.SpotLight(0xffffff, 1.5);
        spotLight.position.set(0, 25, 0); spotLight.penumbra = 0.5; scene.add(spotLight);
        // Purple/Blue rim light for HQ vibe
        const rimLight = new THREE.PointLight(0x8a2be2, 2, 40);
        rimLight.position.set(0, 8, -15); scene.add(rimLight);

        // --- 5. MATERIALS ---
        const consoleMaterial = new THREE.MeshStandardMaterial({ 
            color: 0xffffff, roughness: 0.2, metalness: 0.1, emissive: 0x111133, emissiveIntensity: 0.2 
        });
        const trackMaterial = new THREE.MeshStandardMaterial({ 
            color: 0x8888ff, emissive: 0x3333ff, emissiveIntensity: 0.5, roughness: 0.3, metalness: 0.2
        });

        // --- 6. NEW BACKGROUND: LONG TERM MEMORY SHELVES ---
        // Creates walls of distant glowing memories
        const bgGroup = new THREE.Group();
        const bgGeo = new THREE.SphereGeometry(0.25, 8, 8); // Smaller, distant memories
        const bgColors = [0xFFD700, 0x4A90E2, 0x7FD67F, 0xA359FF]; // Gold, Blue, Green, Purple
        
        for(let i=0; i<400; i++) {
            const color = bgColors[Math.floor(Math.random()*bgColors.length)];
            // Using Basic material for distant glowing lights is efficient
            const mat = new THREE.MeshBasicMaterial({ color: color });
            const mesh = new THREE.Mesh(bgGeo, mat);
            
            // Arrange in rough "shelves" far in the background
            const theta = Math.random() * Math.PI * 2; // angle around center
            const r = 25 + Math.random() * 20; // Distance from center (25 to 45)
            const x = r * Math.cos(theta);
            const z = r * Math.sin(theta) - 15; // Shifted back
            // Stacked vertically in layers
            const y = (Math.floor(Math.random() * 15) * 2) - 10 + Math.random()*0.5; 
            
            mesh.position.set(x, y, z);
            bgGroup.add(mesh);
        }
        scene.add(bgGroup);


        // --- 7. COMPACT CONSOLE GEOMETRY ---
        const standGroup = new THREE.Group();
        scene.add(standGroup);

        const points = [new THREE.Vector2(2.2, 0), new THREE.Vector2(1.2, 2.0), new THREE.Vector2(1.2, 3.5), new THREE.Vector2(4.5, 5.0), new THREE.Vector2(4.5, 5.5)];
        const stand = new THREE.Mesh(new THREE.LatheGeometry(points, 64), consoleMaterial);
        stand.position.y = -3.5;
        standGroup.add(stand);

        const trackGeo = new THREE.RingGeometry(2.5, 4.4, 64);
        const track = new THREE.Mesh(trackGeo, trackMaterial);
        track.rotation.x = -Math.PI / 2;
        track.position.y = 1.75;
        scene.add(track);

        // LID LOWERED FOR COMPACTNESS
        // Lid bottom is now at y = 4.2. Orb tops are at ~4.15. Very snug.
        const lid = new THREE.Mesh(new THREE.CylinderGeometry(4.5, 4.5, 0.3, 64), consoleMaterial);
        lid.position.y = 4.35; 
        scene.add(lid);

        // Shorter pillar to fit new gap
        const pillar = new THREE.Mesh(new THREE.CylinderGeometry(1.2, 1.2, 3.5, 32), new THREE.MeshPhysicalMaterial({color: 0xffffff, transmission: 0.5, opacity: 0.8, transparent:true}));
        pillar.position.y = 2.0;
        scene.add(pillar);

        // --- 8. MEMORY ORBS (New Texture) ---
        const carousel = new THREE.Group();
        carousel.position.y = 2.95; 
        scene.add(carousel);
        
        const clickables = []; 
        const memories = [
            { id: 'joy', color: 0xFFD700, emoji: 'ðŸ˜Š', title: 'JOY', text: 'Keep this Core Memory safe!' },
            { id: 'sadness', color: 0x4A90E2, emoji: 'ðŸ˜¢', title: 'SADNESS', text: 'Crying helps me slow down.' },
            { id: 'anger', color: 0xE74C3C, emoji: 'ðŸ˜ ', title: 'ANGER', text: 'That is absolutely unfair!' },
            { id: 'disgust', color: 0x7FD67F, emoji: 'ðŸ¤¢', title: 'DISGUST', text: 'Ew. No. Just no.' },
            { id: 'fear', color: 0xA359FF, emoji: 'ðŸ˜¨', title: 'FEAR', text: 'We did not die today! Success!' },
            { id: 'envy', color: 0x00A896, emoji: 'ðŸ¥º', title: 'ENVY', text: 'I really want that hair...' }
        ];

        const radius = 3.3;
        const step = (Math.PI * 2) / memories.length;

        memories.forEach((mem, i) => {
            const angle = i * step;
            
            const orbGeo = new THREE.SphereGeometry(1.2, 64, 64);
            // Using new CLOUDY marble texture
            const orbMat = new THREE.MeshPhysicalMaterial({
                color: mem.color, map: createCloudyMarbleTexture(mem.color),
                metalness: 0.2, roughness: 0.15, clearcoat: 1.0, clearcoatRoughness: 0.1,
                emissive: mem.color, emissiveIntensity: 0.45 // High glow
            });

            const orb = new THREE.Mesh(orbGeo, orbMat);
            orb.position.set(Math.cos(angle) * radius, 0, Math.sin(angle) * radius);
            orb.add(new THREE.PointLight(mem.color, 2.5, 6));

            orb.userData = mem; 
            carousel.add(orb);
            clickables.push(orb);
        });

        // Top Core Orb
        const coreGeo = new THREE.SphereGeometry(1.3, 64, 64);
        const coreMat = new THREE.MeshPhysicalMaterial({
            color: 0xFFD700, map: createCloudyMarbleTexture(0xFFD700),
            roughness: 0.1, emissive: 0xFFD700, emissiveIntensity: 0.6
        });
        const coreOrb = new THREE.Mesh(coreGeo, coreMat);
        // Adjusted height for new lid position
        coreOrb.position.set(0, 5.75, 0); 
        
        coreOrb.userData = { emoji: 'ðŸŒŸ', title: 'CORE', text: 'Welcome to Headquarters!', color: 0xFFD700 };
        scene.add(coreOrb);
        clickables.push(coreOrb);


        // --- 9. CHARACTERS ---
        const textureLoader = new THREE.TextureLoader();
        function addCharacter(url, x) {
            textureLoader.load(url, (texture) => {
                const mat = new THREE.SpriteMaterial({ map: texture, transparent: true, opacity: 0.9 });
                const sprite = new THREE.Sprite(mat);
                sprite.scale.set(8, 12, 1);
                sprite.position.set(x, 3.5, -4);
                scene.add(sprite);
            }, undefined, (err) => console.log("Image missing"));
        }
        addCharacter(IMAGE_JOY, -11);
        addCharacter(IMAGE_SADNESS, 11);


        // --- 10. INTERACTION ---
        const raycaster = new THREE.Raycaster();
        const mouse = new THREE.Vector2();
        let isHovering = false;
        let rotationSpeed = 0.015;

        window.addEventListener('mousemove', (e) => {
            mouse.x = (e.clientX / window.innerWidth) * 2 - 1;
            mouse.y = -(e.clientY / window.innerHeight) * 2 + 1;
            raycaster.setFromCamera(mouse, camera);
            isHovering = raycaster.intersectObjects(clickables).length > 0;
            document.body.style.cursor = isHovering ? 'pointer' : 'default';
        });

        window.addEventListener('click', () => {
            if (isHovering) {
                raycaster.setFromCamera(mouse, camera);
                const intersects = raycaster.intersectObjects(clickables);
                if (intersects.length > 0) showPanel(intersects[0].object.userData);
            } else hidePanel();
        });

        const panel = document.getElementById('info-panel');
        function showPanel(data) {
            document.getElementById('panel-emoji').innerText = data.emoji;
            document.getElementById('panel-emoji').style.color = '#' + data.color.toString(16);
            const title = document.getElementById('panel-title');
            title.innerText = data.title;
            title.style.color = '#' + data.color.toString(16);
            document.getElementById('panel-desc').innerText = data.text;
            panel.style.boxShadow = `0 0 60px #${data.color.toString(16)}`;
            panel.style.borderColor = '#' + data.color.toString(16);
            panel.classList.add('active');
        }
        function hidePanel() { panel.classList.remove('active'); }
        document.querySelector('.close-btn').addEventListener('click', hidePanel);
        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });

        // --- 11. ANIMATION ---
        function animate() {
            requestAnimationFrame(animate);

            const targetSpeed = isHovering ? 0 : 0.015; 
            rotationSpeed += (targetSpeed - rotationSpeed) * 0.1;
            carousel.rotation.y -= rotationSpeed;

            const time = Date.now() * 0.001;
            carousel.position.y = 2.95 + Math.sin(time) * 0.05;
            coreOrb.position.y = 5.75 + Math.sin(time*1.2) * 0.1;
            
            // Rotate background layers slowly
            bgGroup.rotation.y += 0.0003;

            renderer.render(scene, camera);
        }
        animate();
    </script>
</body>
</html>